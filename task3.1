/*

*/
#include <WiFiNINA.h>

char ssid[] = "Ansh";
char pass[] = "123456789";
const char* webhookUrl = "/trigger/sunlight_alert/with/key/inE9LYrR33VIVO4bHklquzgYacVVtpPMaozwNRMB0Tn";

WiFiClient client;


const int LIGHT_SENSOR_PIN = 3; 

void setup() {
  Serial.begin(9600);
  while (!Serial);

  // here we are initilising the input pin for the sensor
  pinMode(LIGHT_SENSOR_PIN, INPUT);
  
  // Here we are going for connecting the 
  WiFi.begin(ssid, pass);
  Serial.print("Connecting to WiFi");
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);
    Serial.print(".");
  }
  Serial.println("\nConnected to WiFi");

  // Test connection to the IFTTT server
  if (client.connect("maker.ifttt.com", 80)) {
    Serial.println("Connected to IFTTT server");
    client.stop();  
  } else {
    Serial.println("Connection to IFTTT server failed");
  }
}

void loop() {
  // Read the light sensor value (HIGH for light, LOW for dark)
  int lightValue = HIGH;
  Serial.print("Light Sensor State: ");
  Serial.println(lightValue == HIGH ? "Bright" : "Dark");

  // Check if the light value is high (light detected)
  if (lightValue == HIGH) {
    sendEMAIL_ID();
  } 
  
  delay(600); 
}

void sendEMAIL_ID() {
  
  if (client.connect("maker.ifttt.com", 80)) {
    Serial.println("Sending notification...");
    client.println(); 

    // Read the server response
    while (client.connected()) {
      if (client.available()) {
        char c = client.read();
      }
    }
    
    client.stop();
    Serial.println();
    Serial.println("Disconnected from server");
  }
   else
   {
      Serial.println("There is some error while connecting");
   }
}
